# Introdu√ß√£o

Faaala dev!

Gostaria de lhe dar as boas vindas ao sexto desafio da trilha de **ReactJS** do **Ignite**. üéâ

Nesse desafio vamos construir uma aplica√ß√£o completa, desenvolvendo desde um front-end ao back-end, semelhante ao que vimos no m√≥dulo.

Como se trata de um desafio, ele necessita de alguns conhecimentos al√©m dos abordados nesse m√≥dulo, ent√£o √© importante que tenha autonomia para que consiga pesquisar essas coisas caso n√£o saiba como resolver. Por isso, lembre-se, **tenha calma** e **acredite no seu processo.** O aprendizado daqui √© muito importante, mas voc√™ com certeza vai conseguir sair daqui com muito conhecimento bacana üíú

# Sobre o desafio

Nesse desafio, voc√™ vai aproveitar o que aprendeu durante o m√≥dulo para desenvolver uma plataforma de recomenda√ß√µes para leitores, um lugar onde eles possam avaliar e ver avalia√ß√µes de outros leitores sobre os mais diversos livros.

# Layout do Desafio

Para essa aplica√ß√£o n√≥s fornecemos um layout para que voc√™ possa seguir e implementar os componentes desenhados no Figma.

Para acessar o Figma, voc√™ primeiro deve criar uma conta na plataforma.

### Criando uma conta no Figma

Para acessar o Layout da aplica√ß√£o, voc√™ primeiramente deve ter uma conta criada na plataforma do Figma, para isso, voc√™ pode [clicar aqui](https://www.figma.com/signup).

Ent√£o, na p√°gina de cadastro, voc√™ pode logar diretamente com sua conta do Google ou criar uma conta com o e-mail que voc√™ preferir.

### Acessando o layout do app

Ap√≥s criar e logar em sua conta, voc√™ deve duplicar o Layout do desafio. Para isso, basta voc√™ clicar no link abaixo. Ele adicionar√° o Layout √† sua dashboard do Figma automaticamente, como uma c√≥pia e abrir√° o layout da aplica√ß√£o para a sua visualiza√ß√£o.

[BookWise](https://www.figma.com/file/jTau6bMNSF10GkqwYAbuLA/BookWise/duplicate)

# Desenvolvendo o desafio

Para desenvolver a desafio voc√™ pode tomar a total liberdade de escolha de tecnologias e ferramentas, deixamos isso para que voc√™ possa se desafiar e deixar a sua criatividade e conhecimentos guiar o caminho.

Entretanto, n√≥s iremos dar um direcionamento para que voc√™, caso queira, dar um primeiro passo com algumas configura√ß√µes e padr√µes que criamos. Sinta-se livre para utiliz√°-las caso queira, ou voc√™ pode ignor√°-las e criar tudo do zero caro voc√™ prefira. Voc√™ sempre tem a liberdade para utilizar, alterar e adaptar nossos exemplos para o que fizer mais sentido pra voc√™:

### Estiliza√ß√£o

Criamos um arquivo `stitches.config.ts` com todas as cores e estiliza√ß√µes utilizadas no layout.
_obs: Todas as cores e componentes est√£o dispon√≠veis no style-guide que criamos dentro do figma, basta clicar em `assets` no menu do canto superior direito da tela_

```tsx
// stitches.config.ts

import { createStitches } from '@stitches/react';

export const { styled, getCssText } = createStitches({
  theme: {
    fonts: {
      default: 'Nunito, sans-serif',
    },

		space: {
      px: '1px',
      1: '0.25rem',
      2: '0.5rem',
      3: '0.75rem',
      4: '1rem',
      5: '1.25rem',
      6: '1.5rem',
      7: '1.75rem',
      8: '2rem',
      10: '2.5rem',
    },

		fontSizes:
      xs: '0.75rem',
      sm: '0.875rem',
      md: '1rem',
      lg: '1.125rem',
      xl: '1.25rem',
      '2xl': '1.5rem',
    },

		fontWeights: {
      regular: '400',
      medium: '500',
      bold: '700',
    },

    lineHeights: {
      shorter: '125%',
      short: '140%',
      base: '160%',
      tall: '180%',
    },

    colors: {
			white: '#FFFFFF',
      black: '#000000',

      green: {
        100: '#50B2C0',
        200: '#255D6A',
        300: '#0A313C',
      },

      purple: {
        100: '#8381D9',
        200: '#2A2879',
      },

      gray: {
        100: '#F8F9FC',
        200: '#E6E8F2',
        300: '#D1D6E4',
        400: '#8D95AF',
        500: '#303F73',
        600: '#252D4A',
        700: '#181C2A',
        800: '#0E1116',
      },

			'gradient-vertical': `linear-gradient(180deg, #7FD1CC 0%, #9694F5 100%)`,
      'gradient-horizontal': `linear-gradient(90deg, #7FD1CC 0%, #9694F5 100%)`,
    },

		radii: {
      xs: '2.5px',
      sm: '5px',
      md: '10px',
      lg: '20px',
      full: '99999px',
    },
  },
})
```

E por estarmos utilizando _NextJS_ precisamos configurar o _Stitches_ para ele funcionar com o _Server Side Rendering_, para isso basta criar o seguinte arquivo `_document.tsx` dentro seu diret√≥rio `pages`.

```tsx
// _document.tsx

import React from "react";
import NextDocument, { Html, Head, Main, NextScript } from "next/document";
import { getCssText } from "../stitches.config";

export default class Document extends NextDocument {
  render() {
    return (
      <Html lang="en">
        <Head>
          <style
            id="stitches"
            dangerouslySetInnerHTML={{ __html: getCssText() }}
          />
        </Head>
        <body>
          <Main />
          <NextScript />
        </body>
      </Html>
    );
  }
}
```

### Fonte

Aqui vamos utilizar o recurso de `font` dispon√≠vel nas novas vers√µes do Next JS, para isso voc√™ vai precisar da seguinte configura√ß√£o no seu arquivo `app.tsx`.

```jsx
// _app.tsx

import type { AppProps } from "next/app";
import { Nunito } from "@next/font/google";

export default function MyApp({ Component, pageProps }: AppProps) {
  return (
    <div className={`${nunito.variable}`}>
      <Component {...pageProps} />
    </div>
  );
}
```

### Banco de dados

Vamos utilizar de `SQLite` como banco de dados e `Prisma` como _ORM_, e para facilitar as coisas vamos deixar um arquivo `schema.prisma` abaixo para que voc√™ consiga criar o banco rodando o comando `npx prisma migrate dev`.

```jsx
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(uuid())
  name       String
  avatar_url String?
  created_at DateTime @default(now())

  accounts Account[]
  sessions Session[]
  ratings  Rating[]

  @@map("users")
}

model Book {
  id          String   @id @default(uuid())
  name        String
  author      String
  summary     String
  cover_url   String
  total_pages Int
  created_at  DateTime @default(now())

  categories CategoriesOnBooks[]
  ratings    Rating[]

  @@map("books")
}

model Category {
  id   String @id @default(uuid())
  name String @unique

  books CategoriesOnBooks[]

  @@map("categories")
}

model CategoriesOnBooks {
  book_id    String
  categoryId String

  book     Book     @relation(fields: [book_id], references: [id])
  category Category @relation(fields: [categoryId], references: [id])

  @@id([book_id, categoryId])
}

model Rating {
  id          String   @id @default(uuid())
  rate        Int
  description String
  created_at  DateTime @default(now())

  book    Book   @relation(fields: [book_id], references: [id])
  book_id String

  user    User   @relation(fields: [user_id], references: [id])
  user_id String

  @@map("ratings")
}

model Account {
  id                  String  @id @default(cuid())
  user_id             String
  type                String
  provider            String
  provider_account_id String
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?
  user                User    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id])
  @@map("accounts")
}

model Session {
  id            String   @id @default(cuid())
  session_token String   @unique
  user_id       String
  expires       DateTime
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("sessions")
}
```

Depois de criar o banco voc√™ pode popular ele da forma como preferir, entretanto criamos um arquivo `seed.ts` para que voc√™ j√° tenha dados para utilizar na aplica√ß√£o.

```jsx
import { PrismaClient } from "@prisma/client";
import { books } from "./constants/books";
import { categories } from "./constants/categories";
import { ratings } from "./constants/ratings";
import { users } from "./constants/users";

const prisma = new PrismaClient();

async function main() {
  await prisma.rating.deleteMany();
  await prisma.user.deleteMany();
  await prisma.categoriesOnBooks.deleteMany();
  await prisma.category.deleteMany();
  await prisma.book.deleteMany();

  const usersSeed = users.map((user) => {
    return prisma.user.create({
      data: {
        id: user.id,
        name: user.name,
        avatar_url: user.avatar_url,
      },
    });
  });

  const categoriesSeed = categories.map((category) => {
    return prisma.category.create({
      data: {
        name: category.name,
        id: category.id,
      },
    });
  });

  const booksSeed = books.map((book) => {
    return prisma.book.create({
      data: {
        id: book.id,
        name: book.name,
        author: book.author,
        summary: book.summary,
        cover_url: book.cover_url,
        total_pages: book.total_pages,
        categories: {
          create: [
            ...book.categories.map((category) => {
              return {
                category: {
                  connect: {
                    id: category.id,
                  },
                },
              };
            }),
          ],
        },
      },
    });
  });

  const ratingsSeed = ratings.map((rating) => {
    return prisma.rating.create({
      data: {
        id: rating.id,
        rate: rating.rate,
        description: rating.description,
        user: {
          connect: { id: rating.user_id },
        },
        book: {
          connect: { id: rating.book_id },
        },
      },
    });
  });

  await prisma.$transaction([
    ...categoriesSeed,
    ...booksSeed,
    ...usersSeed,
    ...ratingsSeed,
  ]);
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

Para rodar a seed basta executar o seguinte comando `npx prisma db sedd` !

Note que ainda usamos alguns outros arquivos para popular o nosso banco de dados e para facilitar as coisas vamos disponibilizar toda a pasta `prisma` para que voc√™ fa√ßa o download do arquivo _zip_ e acrescente ao seu projeto.

[prisma.zip](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/835579f0-3b22-46f9-954f-b1c1c1c8706d/prisma.zip)

N√£o se esque√ßa tamb√©m que vamos precisar configurar um arquivo `.env` para que possamos utilizar corretamente a integra√ß√£o com o `Prisma.`

```jsx
# Environment variables declared in this file are automatically made available to Prisma.
# See the documentation for more detail: https://pris.ly/d/prisma-schema#accessing-environment-variables-from-the-schema

# Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server, MongoDB and CockroachDB.
# See the documentation for all the connection string options: https://pris.ly/d/connection-strings

DATABASE_URL="file:./dev.db"
```

### Imagens

Para as capas dos livros indicamos uma solu√ß√£o simples e que vai servir muito bem para esse projeto, vamos usar as imagens armazenadas localmente no projeto, assim basta criar um diret√≥rio `images/` e colar a pasta disponibilizada abaixo

[books.zip](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8aa212a4-c0f1-4a03-9c33-ca5ea7f52c09/books.zip)

_Al√©m disso, vamos dar algumas dicas para voc√™ desenvolver algumas das funcionalidades da aplica√ß√£o._

Note que a aplica√ß√£o concede a possibilidade de acesso tanto para usu√°rios autenticados quanto para usu√°rios n√£o autenticados, limitando algumas funcionalidades da aplica√ß√£o, como por exemplo, realizar uma avalia√ß√£o de um livro e acessar a p√°gina do seu pr√≥prio perfil.

Para fazer a autentica√ß√£o recomendamos que voc√™ utilize a biblioteca `next-auth` e conforme vimos em aula essa biblioteca se baseia no modelo de `OAuth`e disp√µe de v√°rios provedores (_Google, Github, Facebook, ‚Ä¶_), para esse projeto escolhemos utilizar o _Google_ e _Github_ como provedores de autentica√ß√£o.

Para fazer login com o `Google` temos que criar um projeto no _Google Cloud_ e configurar as rotas e acessos, basta entrar no link ([_https://console.cloud.google.com/_](https://console.cloud.google.com/)) e seguir o passo a passo realizado em aula.

Para fazer login com o `Github` o processo √© bem similar ao acima mas por vamos dispor de um passo a passo aqui:

- Adicione o Provider do `Github` no `[...nextauth].ts` :
  ```tsx
  import GitHubProvider from "next-auth/providers/github";
  ...
  providers: [
    GitHubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET
    })
  ]
  ...
  ```
- Agora vamos buscar essas chaves, acesse as configura√ß√£o de `OAuth` do seu github. basta acessar o link ([_https://github.com/settings/developers_](https://github.com/settings/developers))
- Clique nem `New OAuth App` ou o que for correspondente ao seu idioma
- Adicione as informa√ß√µes do _App_ conforme abaixo
  ```
  Application Name: *BookWise*
  Homepage URL: http://localhost:3000
  Application description: (*fique a vontade para escrever uma descri√ß√£o do projeto*)
  Authorization callback URL: http://localhost:3000/api/auth/callback/github
  ```
- Clique em `Register Application`
- Voc√™ deve conseguir ver o seu `Github ID` pegue esse valor e armazene em uma vari√°vel de ambiente.
- Clique em `Generate a new client secret` e em instantes esse novo valor vai ser gerado e exibido em tela, armazene essa informa√ß√£o em uma vari√°vel de ambiente
- _obs_: voc√™ ainda vai precisar de uma informa√ß√£o de `SECRET` para o _NextJS,_ caso n√£o tenha feito esse passo na configura√ß√£o de autentica√ß√£o com Google basta adicionar uma vari√°vel de ambiente com o nome `NEXTAUTH_SECRET` e atribuir um valor aleat√≥rio, caso esteja usando _mac_ execute o comando `openssl rand-base64 32` e copie esse valor para a vari√°vel, caso esteja usando outro sistema operacional voc√™ pode utilizar de geradores de id para gerar uma chave.
- Com tudo isso feito voc√™ deve conseguir se autenticar com o seu `Github` ‚ú®

Para buscar, atualizar ou inserir dados do nosso banco de dados voc√™ pode utilizar a mesma estrat√©gia que utilizamos durante as aulas do m√≥dulo, criando uma `API Route` dentro da sua pasta `pages/api` e declarando ela da forma como achar melhor. Fique a vontade para usar quaisquer bibliotecas de cacheamento de dados de requisi√ß√µes ou o que preferir.
Por exemplo, para buscar um dado livro podemos criar um arquivo `/api/book/index.ts` que busca os dados atrav√©s do _client_ do prisma, algo semelhante a:

```jsx
// /api/book?bookId=48b86ac2-014e-401d-bcbb-331ce5f4a457

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const bookId = String(req.query.bookId);

  const book = await prisma.book.findUnique({
    where: {
      id: bookId,
    },
  });

  return res.json({ book });
}
```

> ‚ö†Ô∏è _N√£o se esque√ßa de instalar todas as depend√™ncias corretamente no seu package.json_

Caso voc√™ tenha alguma dificuldade voc√™ pode ir no nosso **[f√≥rum](https://app.rocketseat.com.br/h/forum/react-js)** e deixar a sua d√∫vida por l√°!

Ap√≥s terminar o desafio, caso voc√™ queira, voc√™ pode tentar dar o pr√≥ximo passo e deixar a aplica√ß√£o com a sua cara. Tente mudar o layout, cores ou at√© adicionar novas funcionalidades para ir al√©m üöÄ

# Entrega

Ap√≥s concluir o desafio, voc√™ deve enviar a URL do seu c√≥digo no Github para a plataforma.

Al√©m disso, que tal fazer um post no LinkedIn compartilhando o seu aprendizado e contando como foi a experi√™ncia?

√â uma excelente forma de demonstrar seus conhecimentos e atrair novas oportunidades! üòç

Obs: Se voc√™ se sentir √† vontade, pode postar um print do resultado final e nos marcar!
Ser√° incr√≠vel acompanhar a sua evolu√ß√£o! üíú

Feito com üíú por Rocketseat üëã
